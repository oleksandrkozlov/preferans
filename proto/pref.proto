syntax = "proto3";

package pref;

message PPlayer {
  string player_id = 1;
  string player_name = 2;
}

message LoginRequest {
  string player_name = 1;
  string password = 2;
}

message LoginResponse {
   string error = 1;
   string player_id = 2;
   string auth_token = 3;
   repeated PPlayer players = 4;
}

message AuthRequest {
  string player_id = 1;
  string auth_token = 2;
}

message AuthResponse {
  string error = 1;
  string player_name = 2;
  repeated PPlayer players = 3;
}

message Logout {
  string player_id = 1;
  string auth_token = 2;
}

message PlayerJoined {
  string player_id = 1;
  string player_name = 2;
}

message PlayerLeft {
  string player_id = 1;
}

message DealCards {
  string player_id = 1;
  repeated string cards = 2;
}

message PlayCard {
  string player_id = 1;
  string card = 2; // e.g. "queen_of_hearts"
}

enum GameStage {
  UNKNOWN = 0;
  BIDDING = 1;
  TALON_PICKING = 2;
  WHISTING = 3;
  HOW_TO_PLAY = 4;
  PLAYING = 5;
}

message PlayerTurn {
  string player_id = 1;
  GameStage stage = 2;
  bool can_half_whist = 3 ; // only for the Whisting stage
  repeated string talon = 4; // queen_of_hearts, etc.
}

message Bidding {
    string player_id = 1;
    string bid = 2; // e.g., "8â™ ", "PASS", "MISER", etc.
}

message OpenTalon {
    string card = 1;
}

message DiscardTalon {
    string player_id = 1;
    repeated string cards = 2; // queen_of_hearts, etc.
    string bid = 3;
}

message Whisting {
    string player_id = 1;
    string choice = 2; // e.g., "Whist", "Half-Whist", "Pass", etc.
}

message OpenWhistPlay {
  string active_whister_id = 1;
  string passive_whister_id = 2;
}

message HowToPlay {
    string player_id = 1;
    string choice = 3; // "", "Openly", or "Closed"
}

message Tricks {
  string player_id = 1;
  int32 taken = 2;
}

message TrickFinished {
  repeated Tricks tricks = 1;
}

message IntSeries {
  repeated sint32 values = 1;
}

message ScoreData {
  IntSeries dump = 1;
  IntSeries pool = 2;
  map<string /*player_id*/, IntSeries> whists = 3;
}

message DealFinished {
  map<string /*player_id*/, ScoreData> score_sheet = 1;
}

message Log {
  string player_id = 1;
  string text = 2;
}

message SpeechBubble {
  string player_id = 1;
  string text = 2;
}

message PingPong {
  int32 id = 1;
}

enum GameType {
  NORMAL = 0;
  RANKED = 1;
}

message UserGame {
  int32 id = 1;
  GameType game_type = 2;
  int64 timestamp = 3;
  int32 duration = 4;
  int32 pool = 5;
  int32 dump = 6;
  int32 whists = 7;
  int32 mmr = 8;
}

message User {
  string player_id = 1;
  string player_name = 2;
  string password = 3;
  repeated string auth_tokens = 4;
  repeated UserGame games = 5;
  int32 version = 100;
}

message GameData {
  repeated User users = 1;
  int32 version = 100;
}

message UserGames {
  repeated UserGame games = 1;
}

message Message {
  string method = 1;
  bytes payload = 2;
}
