// SPDX-License-Identifier: AGPL-3.0-only
// Copyright (c) 2025 Oleksandr Kozlov

edition = "2024";

import "google/protobuf/cpp_features.proto";

option optimize_for = LITE_RUNTIME;

package pref;

message PPlayer {
  string player_id = 1;
  string player_name = 2;
}

message LoginRequest {
  string player_name = 1 [features.(pb.cpp).string_type=STRING];
  string password = 2;
}

message LoginResponse {
   string error = 1;
   string player_id = 2;
   string auth_token = 3;
   repeated PPlayer players = 4;
   GameStage stage = 5;
}

message AuthRequest {
  string player_id = 1;
  string auth_token = 2;
}

message AuthResponse {
  string error = 1;
  string player_name = 2;
  repeated PPlayer players = 3;
  GameStage stage = 4;
}

message Logout {
  string player_id = 1 [features.(pb.cpp).string_type=STRING];
  string auth_token = 2;
}

message PlayerJoined {
  string player_id = 1;
  string player_name = 2;
}

message PlayerLeft {
  string player_id = 1;
}

enum ReadyCheckState {
  NOT_REQUESTED = 0;
  REQUESTED = 1;
  ACCEPTED = 2;
  DECLINED = 3;
}

message ReadyCheck {
  string player_id = 1;
  ReadyCheckState state = 2;
}

message Forehand {
  string player_id = 1;
}

message DealCards {
  string player_id = 1;
  repeated string cards = 2;
}

message PlayCard {
  string player_id = 1;
  string card = 2 [features.(pb.cpp).string_type=STRING]; // e.g. "queen_of_hearts"
}

enum GameStage {
  UNKNOWN = 0;
  BIDDING = 1;
  TALON_PICKING = 2;
  WITHOUT_TALON = 3;
  WHISTING = 4;
  HOW_TO_PLAY = 5;
  PLAYING = 6;
}

message PlayerTurn {
  string player_id = 1;
  GameStage stage = 2;
  string min_bid = 3;
  bool can_half_whist = 4 ; // only for the Whisting stage
  repeated string talon = 5; // queen_of_hearts, etc.
  int32 pass_round = 6; // equals to 0 unless PassGame
}

message Bidding {
    string player_id = 1;
    string bid = 2 [features.(pb.cpp).string_type=STRING]; // e.g., "8â™ ", "PASS", "MISER", etc.
}

message DiscardTalon {
    string player_id = 1;
    repeated string cards = 2; // queen_of_hearts, etc.
    string bid = 3 [features.(pb.cpp).string_type=STRING];
}

message Whisting {
    string player_id = 1;
    string choice = 2; // e.g., "Whist", "Half-Whist", "Pass", etc.
}

message OpenWhistPlay {
  string active_whister_id = 1;
  string passive_whister_id = 2;
}

message OpenTalon {
    string card = 1;
}

message HowToPlay {
    string player_id = 1;
    string choice = 3 [features.(pb.cpp).string_type=STRING]; // "", "Openly", or "Closed"
}

enum Offer {
  NO_OFFER = 0;
  OFFER_REQUESTED = 2;
  OFFER_ACCEPTED = 3;
  OFFER_DECLINED = 4;
}

message MakeOffer {
    string player_id = 1;
    Offer offer = 2;
}

message MiserCards {
  repeated string remaining_cards = 1;
  repeated string played_cards = 2;
}

message Tricks {
  string player_id = 1;
  int32 taken = 2;
}

message CardsLeft {
  string player_id = 1;
  int32 count = 2;
}

message GameState {
  repeated string last_trick = 1;
  repeated Tricks taken_tricks = 2;
  repeated CardsLeft cards_left = 3;
}

message TrickFinished {
  repeated Tricks tricks = 1;
}

message IntSeries {
  repeated sint32 values = 1;
}

message ScoreData {
  IntSeries dump = 1;
  IntSeries pool = 2;
  map<string /*player_id*/, IntSeries> whists = 3;
}

message DealFinished {
  map<string /*player_id*/, ScoreData> score_sheet = 1;
  bool is_game_over = 2;
}

message Log {
  string player_id = 1;
  string text = 2;
}

message SpeechBubble {
  string player_id = 1;
  string text = 2;
}

// Used to relay audio/WebRTC signaling data between players via the server.
message AudioSignal {
  // Player sending the signal.
  string from_player_id = 1;
  // Intended recipient of the signal.
  string to_player_id = 2;
  // Application-defined signal type (e.g., "offer", "answer", "candidate").
  string kind = 3;
  // Opaque payload (JSON/SDP/ICE) serialized as text.
  string data = 4 [features.(pb.cpp).string_type=STRING];
}

message PingPong {
  int32 id = 1;
}

enum GameType {
  NORMAL = 0;
  RANKED = 1;
}

message UserGame {
  int32 id = 1;
  GameType game_type = 2;
  int64 timestamp = 3;
  int32 duration = 4;
  int32 pool = 5;
  int32 dump = 6;
  int32 whists = 7;
  int32 mmr = 8;
}

message User {
  string player_id = 1;
  string player_name = 2;
  string password = 3;
  repeated string auth_tokens = 4;
  repeated UserGame games = 5;
  int32 version = 100;
}

message GameData {
  repeated User users = 1;
  int32 version = 100;
}

message UserGames {
  repeated UserGame games = 1;
}


message Message {
  string method = 1;
  bytes payload = 2;
}
